---
import config from "virtual:lightnet/config"

import { resolveLanguageLabel } from "../../i18n/resolve-language-label"
import { localizePath } from "../../utils/paths"
import Menu from "./Menu.astro"
import MenuItem from "./MenuItem.astro"

const translations = config.locales.map((locale) => ({
  locale,
  label: resolveLanguageLabel(locale),
  active: locale === Astro.currentLocale,
  href: currentPathWithLocale(locale),
}))

function currentPathWithLocale(locale: string) {
  const currentPath = Astro.url.pathname
  const currentPathWithoutLocale = currentPath.startsWith(
    `/${Astro.currentLocale}/`,
  )
    ? currentPath.slice(Astro.currentLocale!.length + 2)
    : currentPath
  return localizePath(locale, currentPathWithoutLocale)
}
---

<Menu icon="mdi--translate" label="ln.header.a11y.select-language">
  {
    translations.map(({ label, locale, active, href }) => (
      <MenuItem href={href} hreflang={locale} active={active}>
        <span
          class="rounded-md border border-gray-400 px-2 py-1 font-mono text-xs font-bold uppercase tracking-widest"
          class:list={[active && "border-gray-900 bg-gray-900 text-gray-50"]}
          slot="before"
        >
          {locale}
        </span>
        {label}
      </MenuItem>
    ))
  }
</Menu>
