---
import { getCollection } from "astro:content"

import { getUsedCategories } from "../../../content/get-categories"
import { contentLanguages } from "../../../content/get-languages"
import { getMediaTypes } from "../../../content/get-media-types"
import SearchListReact from "./SearchList.tsx"
import { prepareI18nConfig } from "../../../i18n/react/prepare-i18n-config"

const { t, currentLocale } = Astro.locals.i18n

const categories: Record<string, string> = {}
for (const { id, name } of await getUsedCategories(currentLocale, t)) {
  categories[id] = name
}

const mediaTypes = Object.fromEntries(
  (await getMediaTypes()).map((type) => [
    type.id,
    {
      name: t(type.data.label),
      icon: type.data.icon,
      coverImageStyle: type.data.coverImageStyle,
    },
  ]),
)

const languages = Object.fromEntries(
  contentLanguages.map((language) => [
    language.code,
    { direction: language.direction, name: t(language.label) },
  ]),
)

const mediaItemsTotal = (await getCollection("media")).length

const showLanguage = contentLanguages.length > 1

const i18nConfig = prepareI18nConfig(Astro.locals.i18n, [
  "ln.search.no-results",
])
---

<SearchListReact
  client:load
  i18nConfig={i18nConfig}
  categories={categories}
  mediaTypes={mediaTypes}
  languages={languages}
  showLanguage={showLanguage}
  mediaItemsTotal={mediaItemsTotal}
/>
