---
import type { GetStaticPaths } from "astro"
import { getCollection } from "astro:content"
import config from "virtual:lightnet/config"

import { getRawMediaItem } from "../../../content/get-media-items"
import { prepareI18nConfig } from "../../../i18n/react/prepare-i18n-config"
import { resolveLocales } from "../../../i18n/resolve-locales"
import Page from "../../../layouts/Page.astro"
import EditForm from "./EditForm"

export const getStaticPaths = (async () => {
  const mediaItems = await getCollection("media")
  return resolveLocales(config).flatMap((locale) =>
    mediaItems.map(({ id: mediaId }) => ({ params: { mediaId, locale } })),
  )
}) satisfies GetStaticPaths

const { mediaId } = Astro.params
const mediaItemEntry = await getRawMediaItem(mediaId)

const i18nConfig = prepareI18nConfig(Astro.locals.i18n, ["ln.admin.*"])
const { t } = Astro.locals.i18n
---

<Page>
  <div class="mx-auto max-w-screen-md px-4 pt-12 md:px-8">
    <a
      class="underline"
      href=`/${Astro.currentLocale}/media/faithful-freestyle--en`
      >{t("ln.admin.back-to-details-page")}</a
    >
    <h1 class="mb-4 mt-8 text-lg">{t("ln.admin.edit-media-item")}</h1>

    <EditForm
      mediaId={mediaId}
      mediaItem={mediaItemEntry.data}
      i18nConfig={i18nConfig}
      client:load
    />
  </div>
</Page>
